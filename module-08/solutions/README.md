# Module 8 Solutions

This directory contains complete, working solutions for Module 8 labs.

## Files

### Lab 8.1 - Multi-Tenant Operator
- **clusterdatabase-types.go**: ClusterDatabase API type definitions (cluster-scoped)
- **clusterdatabase-controller.go**: ClusterDatabase controller implementation
- **multi-tenant-controller.go**: Multi-tenant patterns and helper functions

### Lab 8.2 - Operator Composition
- **backup_types.go**: Backup API type definitions (scaffold with kubebuilder)
- **backup-operator.go**: Complete backup controller
- **operator-coordination.go**: Operator coordination examples

### Lab 8.3 - Stateful Application Management
- **backup.go**: Backup functionality implementation
- **restore.go**: Restore functionality implementation
- **rolling-update.go**: Rolling update handling

## Usage

These solutions can be used as:
- Reference when building advanced operators
- Examples of multi-tenancy patterns
- Operator composition patterns
- Stateful application management examples

## Integration

### For Multi-Tenancy (Lab 8.1)

Use kubebuilder to scaffold the ClusterDatabase API, then reference the solutions:

```bash
# 1. Scaffold the API
kubebuilder create api --group database --version v1 --kind ClusterDatabase

# 2. Reference clusterdatabase-types.go for type definitions
# 3. Reference clusterdatabase-controller.go for controller logic
# 4. Reference multi-tenant-controller.go for advanced patterns
```

Key concepts demonstrated:
- `+kubebuilder:resource:scope=Cluster` marker for cluster-scoped resources
- `targetNamespace` field for specifying where to create resources
- Label-based ownership (since OwnerReferences can't cross scope boundaries)
- Finalizers for cleanup
- Quota checking per namespace/tenant

### For Operator Composition (Lab 8.2)

Use kubebuilder to scaffold the Backup API, then reference the solutions:

```bash
# 1. Scaffold the API
kubebuilder create api --group backup --version v1 --kind Backup --resource --controller

# 2. Reference backup_types.go for type definitions
# 3. Reference backup-operator.go for controller logic
# 4. Reference operator-coordination.go for coordination patterns
```

Key concepts demonstrated:
- `DatabaseRef` field references the Database to backup
- Controller waits for Database to be ready before backing up
- Status conditions (`BackupReady`) coordinate state between operators
- Scheduled backups using cron expressions

### For Stateful Applications (Lab 8.3)

- Integrate `backup.go` for backup functionality
- Use `restore.go` for restore operations
- Handle rolling updates with `rolling-update.go`

## Comparison: Database vs ClusterDatabase

| Feature | Database | ClusterDatabase |
|---------|----------|-----------------|
| Scope | Namespaced | Cluster |
| Namespace | Implicit | Explicit (`targetNamespace`) |
| OwnerReferences | Yes | No (use labels) |
| Cleanup | Automatic (GC) | Manual (finalizers) |
| Use case | Team resources | Platform management |

## Notes

- These are complete, working examples
- They demonstrate advanced patterns
- Ready for production use
- Follow best practices
- CRDs are generated by kubebuilder using `make manifests`
